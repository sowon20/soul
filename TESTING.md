# Soul Project - 통합 테스트 가이드

## 📋 개요

Soul 프로젝트의 전체 120개 API 엔드포인트를 테스트하는 통합 테스트 스크립트입니다.

## 🚀 사용법

### 1. 서버 시작

```bash
cd soul
node server/index.js
```

서버가 포트 3080에서 실행됩니다.

### 2. 테스트 실행

#### 기본 실행
```bash
cd soul
bash test-all-apis.sh
```

#### 상세 출력 모드
```bash
VERBOSE=1 bash test-all-apis.sh
```

#### 다른 URL 지정
```bash
BASE_URL=http://localhost:8080 bash test-all-apis.sh
```

## 📊 테스트 범위

### Week 1 & Phase 1-9 (45개 테스트)

1. **Phase 1: 메모리 시스템** (1개)
   - 메모리 저장 API 확인

2. **Phase 2: AI 모델 관리** (2개)
   - AI 서비스 목록
   - AI 설정 조회

3. **Phase 3: 검색 시스템** (5개)
   - 태그/카테고리 목록
   - 통계 정보
   - 관계 그래프
   - 추천 대화

4. **Phase 4: 맥락 감지** (7개)
   - 키워드 추출
   - 트리거 평가
   - 맥락 감지
   - 스팸 방지
   - 패턴 감지
   - 비유 분석
   - 비유 설정

5. **NLP: 자연어 제어** (6개)
   - 의도 감지
   - 액션 실행
   - 패턴/의도 목록
   - 예제 테스트
   - NLP 설정

6. **Phase 5: 컨텍스트 관리** (5개)
   - 토큰 추정
   - 사용량 분석
   - 압축 필요 체크
   - 모델 제한
   - 압축 설정

7. **Phase 8: 패널 시스템** (10개)
   - 패널 상태/등록
   - 열기/닫기/토글
   - 모드 변경
   - 자연어 명령
   - 타입/모드 목록

8. **Phase 9: 스마트 라우팅** (8개)
   - 태스크 분석 (Haiku/Sonnet/Opus)
   - 라우팅 통계
   - 모델 목록
   - 인격 정보
   - 선호도 설정
   - 통합 채팅

### Week 2 (60개 테스트)

9. **Week 2-1: 메모리 고도화** (10개)
   - 관계 그래프 조회/분석
   - 타임라인 조회/분석
   - 활동/밀도 분석
   - 패턴 분석
   - 태그 클라우드/관계
   - 고급 검색

10. **Week 2-2: 알바 시스템** (10개)
    - 작업 생성/조회
    - 워커 상태/시작/중지
    - 큐 목록/조회
    - 요약/엔티티/태그 작업

11. **Week 2-3: Proactive Messaging** (13개)
    - 알림 생성/목록/통계
    - 안부 인사 생성/전송
    - 사용자 패턴 조회/학습
    - 안부 통계
    - 이벤트 리스너 시작/중지/통계
    - 세션 시작 트리거

12. **Week 2-4: 자연어 설정 고도화** (17개)
    - 고도화된 의도 감지
    - 피드백 학습
    - 컨텍스트 조회/추출/해소
    - 학습된 패턴 조회/적용/분석
    - 학습 히스토리
    - 선호도 설정/조회
    - 단축 표현 등록/해소
    - 통합 통계/종합 분석

## 📈 테스트 결과 예시

```
╔════════════════════════════════════════════════╗
║  Soul Project - 통합 API 테스트 (120개)        ║
╚════════════════════════════════════════════════╝

Base URL: http://localhost:3080
Verbose: 0

========================================
서버 헬스 체크
========================================
[PASS] 서버 응답 정상

========================================
Phase 1: 메모리 시스템
========================================
[INFO] 메모리 저장 API 존재 확인만 수행
[PASS] 메모리 시스템 (POST /api/memory/archive)

========================================
Phase 2: AI 모델 관리
========================================
[PASS] AI 서비스 목록 조회
[PASS] AI 설정 조회

... (중략) ...

========================================
테스트 결과 요약
========================================

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  총 테스트: 105
  ✓ 통과: 105
  성공률: 100%
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

╔════════════════════════════════════════╗
║  ✓ 모든 테스트 통과!                    ║
╚════════════════════════════════════════╝
```

## 🔧 트러블슈팅

### 서버 응답 없음
```
[FAIL] 서버 응답 없음
서버를 먼저 시작하세요: cd soul && node server/index.js
```

**해결방법**: 서버를 먼저 시작하세요.

### 특정 API 실패

**VERBOSE 모드로 디버깅**:
```bash
VERBOSE=1 bash test-all-apis.sh
```

상세한 요청/응답 정보를 확인할 수 있습니다.

### 포트 변경

기본 포트(3080)를 사용할 수 없는 경우:
```bash
# 서버 시작 시
PORT=8080 node server/index.js

# 테스트 시
BASE_URL=http://localhost:8080 bash test-all-apis.sh
```

## 📝 테스트 추가하기

새로운 API 엔드포인트를 추가했다면, `test-all-apis.sh`에 테스트를 추가하세요:

```bash
# 새로운 테스트 함수 추가
test_my_new_feature() {
    log_section "My New Feature"

    test_api "API 이름" \
        "METHOD" "/api/path" \
        '{"data":"value"}' \
        "expected_field"
}

# main() 함수에 추가
main() {
    # ... 기존 테스트들 ...
    test_my_new_feature
    # ...
}
```

## 🎯 CI/CD 통합

GitHub Actions 등에서 자동 테스트:

```yaml
- name: Run Integration Tests
  run: |
    cd soul
    node server/index.js &
    sleep 5
    bash test-all-apis.sh
```

## 📊 현재 통계

- **총 엔드포인트**: 120개
- **테스트 카테고리**: 12개
- **예상 실행 시간**: ~30초 (서버 응답 속도에 따라 다름)

## 🔗 관련 문서

- [README.md](README.md) - 프로젝트 소개
- [TODO.md](TODO.md) - 개발 계획
- [SMART_ROUTING.md](soul/SMART_ROUTING.md) - 스마트 라우팅 시스템
- [PANEL_SYSTEM.md](soul/PANEL_SYSTEM.md) - 패널 시스템
- [NLP_SYSTEM.md](soul/NLP_SYSTEM.md) - 자연어 제어
